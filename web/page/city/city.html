<#include "/page/template/_layout.html"/>
<@layout>

<#if airData.quality=="优">
    <div class="citydata_banner_width banner_bg_level1">
        <#elseif  airData.quality=="良">
    <div class="citydata_banner_width banner_bg_level2">
        <#elseif  airData.quality=="轻度污染">
    <div class="citydata_banner_width banner_bg_level3">
        <#elseif  airData.quality=="中度污染">
    <div class="citydata_banner_width banner_bg_level4">
        <#elseif  airData.quality=="重度污染">
    <div class="citydata_banner_width banner_bg_level5">
        <#elseif  airData.quality=="严重污染">
    <div class="citydata_banner_width banner_bg_level6">
        <#else>
    <div class="citydata_banner_width banner_bg_level1">
</#if>
    <div class="citydata_banner">
        <div class="citydata_banner_top">
            <div class="citydata_changecity">
                <!--<a class="bi_location_add minicity_clk" href="javascript:void(0)"></a>-->
                <span class="city_name">${cityName}</span>
                <span class="city_description">Air Quality Index</span>
            </div>
            <div class="citydata_updatetime">Update Time: ${timePoint}</div>
            <div class="clear"></div>
        </div>

        <div class="citydata_banner_opacity">
            <div class="cbo_left">
                <div class="cbol_aqi">
                    <div class="cbol_aqi_num">${airData.aqi}</div>
                    <div class="cbol_aqi_name">AQI</div>
                </div>
                <div class="cbol_nongdu">
                    <a class="cbol_nongdu_num " >
                        <span class="cbol_nongdu_num_1">${airData.pm10}</span>
                        <span class="cbol_nongdu_num_2">μg/m³</span>
                    </a>
                    <a class="cbol_nongdu_name">PM10</a>
                </div>
                <div class="cbol_nongdu">
                    <a class="cbol_nongdu_num " >
                        <span class="cbol_nongdu_num_1">${airData.pm25}</span>
                        <span class="cbol_nongdu_num_2">μg/m³</span>
                    </a>
                    <a class="cbol_nongdu_name">PM2.5</a>
                </div>
            </div>
            <div class="cbo_right">
                <div class="cbor_gauge">
                    <#if airData.quality=="优">
                        <span class="cbor_gauge_level1">优</span>
                    <#elseif  airData.quality=="良">
                        <span class="cbor_gauge_level2">良</span>
                    <#elseif  airData.quality=="轻度污染">
                        <span class="cbor_gauge_level3">轻度污染</span>
                    <#elseif  airData.quality=="中度污染">
                        <span class="cbor_gauge_level4">中度污染</span>
                    <#elseif  airData.quality=="重度污染">
                        <span class="cbor_gauge_level5">重度污染</span>
                    <#elseif  airData.quality=="严重污染">
                        <span class="cbor_gauge_level6">严重污染</span>
                    <#else>
                        <span class="cbor_gauge_level1">优</span>
                    </#if>
                    <p class="cbor_gauge_img"></p>
                    <p class="cbor_gauge_num">0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;150&nbsp;&nbsp;&nbsp;&nbsp;200&nbsp;&nbsp;&nbsp;300&nbsp;&nbsp;&nbsp;500</p>
                </div>
                <div class="cbor_tips">
                    <p>
                        <span>Tips: </span>
                        ${tips}                                      </p>
                </div>
            </div>
            <div class="clear"></div>
        </div>
        <div class="cbo_opacity"></div>
    </div>
</div>
<div class="main_width">
    <div class="main">
        <div class="panel_jiance">
            <p class="pg_title">${cityName} Each Monitor Locations Real-time Data</p>
            <div data-widget-cid="widget-1" class="pj_area ui-switchable">
                <div class="pj_area_data ui-switchable-content">
                    <div class="pj_area_data_title">
                        <span class="pjadt_location">Location</span>
                        <a class="pjadt_aqi aqi_arrow_top" href="javascript:void(0)" style="cursor:default;">
                            <span>AQI</span>
                        </a>
                        <span class="pjadt_quality">Quality</span>
                        <span class="pjadt_wuranwu">Pollution</span>
                        <span class="pjadt_pm25">PM2.5</span>
                        <span class="pjadt_pm10">PM10</span>
                        <div class="clear"></div>
                    </div>
                    <ul class="pj_area_data_details ui-switchable-panel">
                        <#list monitorlocations as monitorlocation>
                            <#if monitorlocation_index%2==0 >
                                <li class="pj_area_data_item level5 ">
                            <#else><li class="pj_area_data_item level1 pj_area_data_item_darkbg ">
                            </#if>
                            <b></b>
                            <a class="pjadt_location" href="/monitorLocation/${monitorlocation.monitorName}">${monitorlocation.monitorName}</a>
                            <span class="pjadt_aqi">${monitorlocation.aqi}<i class=""></i></span>
                            <span class="pjadt_quality">
                                <#if monitorlocation.quality=="优">
                                    <em class="pjadt_quality_bglevel_1">
                                <#elseif  monitorlocation.quality=="良">
                                    <em class="pjadt_quality_bglevel_2">
                                <#elseif  monitorlocation.quality=="轻度污染">
                                    <em class="pjadt_quality_bglevel_3">
                                <#elseif  monitorlocation.quality=="中度污染">
                                    <em class="pjadt_quality_bglevel_4">
                                <#elseif  monitorlocation.quality=="重度污染">
                                    <em class="pjadt_quality_bglevel_5">
                                <#elseif  monitorlocation.quality=="严重污染">
                                    <em class="pjadt_quality_bglevel_6">
                                <#else>
                                    <em class="pjadt_quality_bglevel_1">
                                </#if>
                                <#if monitorlocation.quality=="">
                                    --</em>
                                <#else>
                                    ${monitorlocation.quality}</em>
                                </#if>

                            </span>
                            <a class="pjadt_wuranwu" >
                                <#if monitorlocation.quality=="">
                                    --
                                <#else>
                                    ${monitorlocation.primaryPollution}
                                </#if>
                            </a>
                            <span class="pjadt_pm25">${monitorlocation.pm25} <em>μg/m³</em><i class=""></i></span>
                            <span class="pjadt_pm10">${monitorlocation.pm10}<em>μg/m³</em><i class=""></i></span>
                            <div class="clear"></div>
                            </li>
                        </#list>
                    </ul>
                </div>
            </div>
        </div>

        <div id="scrollbar1" class="minicity ui-switchable" style="display:block;" data-widget-cid="widget-0">
            <div class="minicity_title">
                <a class="mt_close"><i></i></a>
                <p>
                    <!--<span class="minicity_title_wenzi">选择城市</span>-->
                    <a href="/comparison" class="mt_maplink" target="_blank">进入地图模式&gt;&gt;</a>
                </p>
            </div>
            <div class="scrollbar" style="height: 499px;">
                <div class="track" style="height: 499px;">
                    <div class="thumb" style="top: 0px; height: 54.3077px;">
                        <div class="end"></div>
                    </div>
                </div>
            </div>
            <div class="minicity_content viewport" style="height: 499px;">
                <div class="overview ui-switchable-content" style="top: 0px;">
                    <!--工具条上方的热门城市部分内容-->
                    <div class="hot_city">
                        <dl>
                            <dt>Hot Cities:</dt>
                            <dd>
                                <a href="/北京">北京</a>
                                <a href="/上海">上海</a>
                                <a href="/广州">广州</a>
                                <a href="/深圳">深圳</a>
                                <a href="/杭州">杭州</a>
                                <a href="/天津">天津</a>
                                <a href="/成都">成都</a>
                                <a href="/南京">南京</a>
                                <a href="/西安">西安</a>
                                <a href="/武汉">武汉</a>
                            </dd>
                        </dl>
                        <div class="clear"></div>
                    </div>

                    <!--筛选工具条-->
                    <div class="city_control">
                        <div class="city_control_tab"><!---当前是谁，就在谁上边加“city_control_current”-->
                            <a class="city_control_current tab_pc" href="javascript:void(0)">Province</a>
                            <a class="tab_fc" href="javascript:void(0)">City</a>
                        </div>

                        <div class="c_search">
                            <div class="search_city">
                                <input type="text" value="" placeholder="输入城市名" class="search_city_text" id="autocomplete">
                                <input type="button" class="search_btn search_btn_active">
                                <div class="clear"></div>
                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>

                    <div class="city_province" style="display:block;">
                        <#list provinceCities.keySet() as province>
                            <!--一般城市-->
                            <div class="city_province_item">
                                <dl>
                                    <dt>${province}</dt>
                                    <dd>
                                        <#list provinceCities.get(province) as city>
                                            <a href="/${city}">${city}</a>
                                        </#list>
                                    </dd>
                                </dl>
                                <div class="clear"></div>
                            </div>
                        </#list>
                    </div>

                    <div class="city_province city_citys">
                        <#list cityPrefixes.keySet() as prefix>
                            <!--一般城市-->
                            <div class="city_province_item">
                                <dl>
                                    <dt class="cpi_capital">${prefix}</dt>
                                    <dd>
                                        <#list cityPrefixes.get(prefix) as city>
                                            <a href="/${city}">${city}</a>
                                        </#list>
                                    </dd>
                                </dl>
                                <div class="clear"></div>
                            </div>
                        </#list>
                    </div>

                </div>
            </div>
        </div>

        <style>
            .minicity {right: -900px;}
        </style>

        <div class="panel_graph panel_onlyone">
            <p class="pg_title">${cityName} Last 24 hours AQI Trend</p>
            <div class="pg_area">
                <!--曲线图从这里开始,放到这里-->
                <div id="pg_content_24h" class="pg_content" style="background-color:#f7f7f7;"></div>
            </div>
        </div>

        <div class="panel_graph panel_onlyone">
            <p class="pg_title">${cityName} Last Week AQI Trend</p>
            <div class="pg_area">
                <!--曲线图从这里开始,放到这里-->
                <div id="pg_content_7d" class="pg_content" style="background-color:#f7f7f7;"></div>
            </div>
        </div>

        <div class="panel_graph panel_onlyone">
            <p class="pg_title">${cityName} Last Month AQI Trend</p>
            <div class="pg_area">
                <!--曲线图从这里开始,放到这里-->
                <div id="pg_content_30d" class="pg_content" style="background-color:#f7f7f7;"></div>
            </div>
        </div>

    </div>
</div>


</@layout>



<@script>
    <script src="resource/static/js/echarts.min.js"></script>
    <script src="resource/static/js/sea.js"></script>
</@script>

<script>
    seajs.use(['$', 'tabs', 'cookie', 'tinyscrollbar', 'autocomplete'], function($, Tabs, Cookie){

        $(document).ready(function(){
            new Tabs({
                element: '.minicity',
                triggers: '.city_control_tab a',
                triggerType: 'click',
                activeTriggerClass: 'city_control_current',
                panels: '.city_province',
                activeIndex: 0
            });

            $('.tab_pc').click(function(){
                $('.pc_a_z').show();
                $('.fc_a_z').hide();
            });

            $('.tab_fc').click(function(){
                $('.pc_a_z').hide();
                $('.fc_a_z').show();
            });

            $('.minicity_clk').click(function(){
                $('.minicity').animate({right:0}, 'slow');
            });
            $('.mt_close').click(function(){
                $('.minicity').animate({right:'-900px'}, 'slow');
            });

            var h = $(window).height()-132;if(h<0)h=0;
            $(".viewport").css('height',h);
            $('#scrollbar1').tinyscrollbar();

            window.onresize = function(){
                var h = $(window).height()-132;if(h<0)h=0;
                $(".viewport").css('height',h);
                $(".scrollbar").css('height',h);
                $(".track").css('height',h);
                $('#scrollbar1').tinyscrollbar();
            }

            $('.city_citys').addClass('hide');

            var checkCity = function(){
                $.ajax({
                    type: "post",
                    dataType: 'json',
                    url: '/checkCity',
                    data: {cityname: $('#autocomplete').val()},
                    success:function(res){
                        if(res.err == 0) {
                            window.location.href = '/'+res.cityname;
                        } else {
                            alert('对不起，该城市不存在!')
                        }
                    }
                });
            }

            $('.search_btn').click(function(){
                checkCity();
            });

            $('.search_city_text').keypress(function(e){
                if(e.which == 13) {
                    checkCity();
                }
            });

            $('.city_default_shezhi').click(function(){
                var currentCity = $('.city_default_shezhi').attr('city');
                Cookie.set('default_city', currentCity, {
                    path: '/',
                    expires: 18000
                });
                $('.city_default_two').show();
                $('.default_city').text(currentCity);
                $('.city_default_shezhi').hide();
            });

            $('.city_default_shanchu').click(function(){
                Cookie.remove('default_city', {
                    path: '/'
                });
                $('.city_default_two').hide();
                $('.city_default_shezhi').show();
            });

        });

    });
</script>

<@javascript>
<script src="resource/static/js/graph-last24-aqi.js"></script>
<script src="resource/static/js/graph-last7d-aqi.js"></script>
<script src="resource/static/js/graph-last30d-aqi.js"></script>
</@javascript>